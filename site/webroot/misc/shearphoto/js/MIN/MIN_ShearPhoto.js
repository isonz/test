window.ShearPhoto=function(){this.transform=this.DomMoveEve=this.DomUpEve=this.MoveDivEve=this.zoomEve=this.eveMold=!1,this.DivDownEVe={},this.transformFun(),!this.addevent&&window.addEventListener?(this.addevent="add",this.selectionempty=function(){window.getSelection().removeAllRanges()}):(this.addevent="att",this.selectionempty=function(){document.selection.empty()}),this.MyAjax=new window.ShearPhoto.MyAjax},window.ShearPhoto.prototype={transformFun:function(){var a,b=document.body.style,c=new Array("MsTransform","MozTransform","WebkitTransform","WebkitTransform","OTransform","transform");for(a=0;a<c.length;a++)if(c[a]in b){this.transform=c[a];break}},HTML5:{Reg:new RegExp("translate3d\\((.*?)\\)","i"),HTML5LT:function(a){a?(this.getLT=function(b){return domstyleTransform=this.Reg.exec(b.style[a]),domstyleTransform?domstyleTransform[1].split(",",2):[0,0]},this.setLT=function(b,c,d){var e=b.style,f=!0,g=e[a],h="translate3d("+c+","+d+",0)",i=g.replace(this.Reg,function(){return f=!1,h});e[a]=f?g+" "+h:i},this.setL=function(b,c){var d=b.style,e=!0,f=d[a],g=f.replace(this.Reg,function(a,b){e=!1;var d=b.split(",",2)[1];return"translate3d("+c+","+d+",0)"});d[a]=e?f+" "+"translate3d("+c+",0,0)":g},this.setT=function(b,c){var d=b.style,e=!0,f=d[a],g=f.replace(this.Reg,function(a,b){e=!1;var d=b.split(",",2)[0];return"translate3d("+d+","+c+",0)"});d[a]=e?f+" "+"translate3d(0,"+c+",0)":g}):(this.getLT=function(a){var b=a.style;return[b.left||0,b.top||0]},this.setLT=function(a,b,c){var d=a.style;d.left=b,d.top=c},this.setL=function(a,b){a.style.left=b},this.setT=function(a,b){a.style.top=b})},URL:window.URL||window.webkitURL||window.mozURL||window.msURL||!1,canvas:!1,Images:!1,ImagesType:"image/jpeg",HTML5PHP:!1,HTML5MAX:!1,HandleRotation:function(a,b,c,d,e,f,g,h){var i,j,k,l,m,n=a.ImgOHeight,o=a.ImgOWidth,p=[Math.ceil(o*f),Math.ceil(n*f)];switch(b){case 90:i=p[1],j=p[0],k=0,l=j;break;case 180:i=p[0],j=p[1],k=i,l=j;break;case 270:i=p[1],j=p[0],k=i,l=0}d.width=i,d.height=j,e.translate(k,l),e.rotate((360-b)*Math.PI/180),e.drawImage(a.arg.ImgMain,0,0,o,n,0,0,p[0],p[1]),m=e.getImageData(0,0,i,j),e.clearRect(0,0,p[0],p[1]),e.fillStyle="#FFFFFF",e.fillRect(0,0,p[0],p[1]),d.width=c.IW=g,d.height=c.IH=h,e.putImageData(m,-c.X*f,-c.Y*f),delete m},zipImg:function(a,b,c,d){var e=new Image,f=this;e.onload=function(){var a,g,h,i,j,k,l=document.createElement("canvas");l.style.display="none",a=document.body,a.appendChild(l),g=l.getContext("2d"),h=this.width,i=this.height,b&&(j=h/i,h>b[0]&&(h=b[0],i=Math.round(b[0]/j)),i>b[0]&&(i=b[0],h=Math.round(b[0]*j),h>b[0]&&(h=b[0],i=Math.round(b[0]/j)))),l.width=h,l.height=i,g.fillStyle="#FFFFFF",g.fillRect(0,0,h,i),g.drawImage(e,0,0,this.width,this.height,0,0,h,i),k=l.toDataURL(c,b?b[1]:.85),f.URL?(f.BOLBID&&f.URL.revokeObjectURL(f.BOLBID),f.BOLBID=f.URL.createObjectURL(f.FormBlob(k)),"function"==typeof d&&d(f.BOLBID)):"function"==typeof d&&d(k),g.clearRect(0,0,h,i),a.removeChild(l),delete k,delete e},e.src=a,delete a},CtxDrawImage:function(a,b,c,d){var e,f,g,h,i,j,k,l,m=b.R,n=d.arg;this.HTML5MAX?(e=b.IW,f=e,g=b.IH,h=e/g,e>this.HTML5MAX?(e=this.HTML5MAX,g=Math.round(e/h),g>this.HTML5MAX&&(g=this.HTML5MAX,e=Math.round(g*h))):g>this.HTML5MAX&&(g=this.HTML5MAX,e=Math.round(g*h),e>this.HTML5MAX&&(e=this.HTML5MAX,g=Math.round(e/h))),h=e/f,0===m?(i=d.ImgOWidth-b.X,j=d.ImgOHeight-b.Y,k=i*h,l=j*h,c.width=b.IW=e,c.height=b.IH=g,a.fillStyle="#FFFFFF",a.fillRect(0,0,k,l),a.drawImage(n.ImgMain,b.X,b.Y,i,j,0,0,k,l)):this.HandleRotation(d,m,b,c,a,h,e,g)):0===m?(c.width=b.IW,c.height=b.IH,a.fillStyle="#FFFFFF",a.fillRect(0,0,b.IW,b.IH),a.drawImage(n.ImgMain,-b.X,-b.Y)):this.HandleRotation(d,m,b,c,a,1,b.IW,b.IH)},lock:!1,PhotoHTML5True:!1,SetSrc:function(a,b,c,d){b.src=c.src=a;for(var e=0;e<d[1];e++)d[0][e].src=a;delete a},BOLBID:!1,Aclick:!1,artwork:!1,EffectsReturn:function(){this.Aclick&&(this.Aclick.className=""),this.Aclick=this.artwork,this.artwork&&(this.artwork.className="Aclick")},Effects:function(a,b){var c,d=this.arg.ImgMain,e=this.arg.ImgDom,f=this.preview,g=this;return function(){if(!b.lock){if(b.Aclick===this)return g.pointhandle(1500,1,"亲！现在已经是"+a+"效果了,吃饱饭没事干吗？",2,"#307ff6","#fff"),void 0;b.lock=!0,c=window.ShearPhoto.psLib(b.Images),b.Aclick&&(b.Aclick.className=""),b.Aclick=this,this.className="Aclick",g.pointhandle(0,1,"正在加载"+a+"效果！稍等....，不要动鼠标，可能有点卡",2,"#fbeb61","#3a414c",function(){setTimeout(function(){var h,i=f.domimg;h="原图"===a?c.save(!1,b.ImagesType):c.ps(a).save(!1,b.ImagesType),b.URL?(b.BOLBID&&b.URL.revokeObjectURL(b.BOLBID),b.BOLBID=b.URL.createObjectURL(b.FormBlob(h)),b.SetSrc(b.BOLBID,d,e,i)):b.SetSrc(h,d,e,i),delete h,g.pointhandle(1500,1,a+"效果加载成功！提示：如果机器配置差，效果加载时间会更长哦",1,"#307ff6","#fff"),b.lock=!1,b.PhotoHTML5True=!0},1)})}}},BlobRegExp:new RegExp("^data:.*base64,"),FormBlob:function(a){var b,c,d,e,f=!1,g=a.replace(this.BlobRegExp,function(){return f=!0,""});for(b=f?atob(g):unescape(g),c=b.length,d=new Uint8Array(c),e=0;c>e;e++)d[e]=b.charCodeAt(e);return new Blob([d],{type:this.ImagesType})},IfHTML5:function(a,b,c){try{new Blob(["1"],{type:"text/plain"})}catch(d){b=!1}a&&b&&(this.canvas=!0,this.HTML5MAX=c)},CanvasImg:function(a,b,c){var d,e,f,g,h=document.createElement("canvas"),i=document.body;if(h.style.display="none",i.appendChild(h),d=h.getContext("2d"),this.CtxDrawImage(d,a,h,c),e=this.FormBlob(h.toDataURL(this.ImagesType,c.arg.HTML5Quality)),d.clearRect(0,0,a.IW,a.IH),i.removeChild(h),f=new FormData,f.append("ShearPhotoIW",a.IW),f.append("ShearPhotoIH",a.IH),f.append("ShearPhotoFW",a.FW),f.append("ShearPhotoFH",a.FH),f.append("ShearPhotoP",c.arg.proportional[0]),"[object Object]"===Object.prototype.toString.call(b))for(g in b)f.append(g,b[g]);return f.append("UpFile",e),f}},_ieexchange_:function(){function a(a,c){var d=new Array(b[a],b[c]);b[a]=d[1],b[c]=d[0]}var b=this;a("ImgWidth","ImgHeight")},SetRote:{ROReg:new RegExp("rotate\\((.*?)\\)","i"),SLReg:new RegExp("translate\\((.*?)\\)","i"),run:function(a,b,c,d){var e=a.style,f=!0,g=e[b],h=g.replace(this.ROReg,function(){return f=!1,c}),i=f?g+" "+c:h,f=!0,j=i.replace(this.SLReg,function(){return f=!1,d}),i=f?i+" "+d:j;return i},runSL:function(a,b,c){var d=a.style,e=!0,f=d[b],g=f.replace(this.SLReg,function(){return e=!1,c});return e?f+" "+c:g}},_exchange_:function(){var a,b,c=this;return this._ieexchange_(),a=this.rotate,90===a||270===a?(b={90:-1,270:1}[a],this.ImgRotateFun=function(a,d){var e=b*Math.round(.5*(d-a))+"px",f=this.arg,g="translate("+e+","+e+")";return f.ImgMain.style[c.transform]=c.SetRote.runSL(f.ImgMain,c.transform,g),f.ImgDom.style[c.transform]=c.SetRote.runSL(f.ImgDom,c.transform,g),[d,a]},function(a,d,e){var f=b*Math.round(.5*(c.ImgWidth-c.ImgHeight)),g="translate("+f+"px,"+f+"px)";return a.style[c.transform]=c.SetRote.run(a,c.transform,e,g),d.style[c.transform]=c.SetRote.run(d,c.transform,e,g),f}):(this.preview.WH=[c.ImgWidth,c.ImgHeight],this.ImgRotateFun=function(a,b){return[a,b]},function(a,b,d){return a.style[c.transform]=c.SetRote.run(a,c.transform,d,"translate(0,0)"),b.style[c.transform]=c.SetRote.run(b,c.transform,d,"translate(0,0)"),0})},preview:{isW:new Array,isH:new Array,run:function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z=this;if("[object Array]"===Object.prototype.toString.call(a.preview)&&(c=a.preview.length,d=function(){},e=a.relativeUrl+"images/default.gif",c>0)){for(a.scope.parentNode.insertAdjacentHTML("afterEnd",'<div id="preview" style="display:none;margin-left:8px;"></div>'),f="",g=d,h=!1,a.proportional[0]?h=a.proportional[0]:g=function(a,b,c,d){a[1][c].style.height=Math.round(b[c]/d[0]*d[1])+"px"},i=10,j=5,k=i+2*j,l=0;c>l;l++)this.domWidth+=a.preview[l]+k,m=h?Math.round(a.preview[l]/h)+"px;":"auto;",f+='<a href="javascript:;" style="width:'+a.preview[l]+"px;height:"+m+"margin-right:"+i+"px;background-color: #F5F5F5;border: "+j+"px solid #F5F5F5;"+'"><img src="'+e+'"/></a>';this.dom=document.getElementById("preview"),this.dom.innerHTML=f,this.dom.parentNode.style.width=a.scopeWidth+2+"px",u=[this.dom.getElementsByTagName("img"),this.dom.getElementsByTagName("a")],v=function(a,b){a.src=b},w=function(a,c,d,e){var f,g=Math.round(c[0]*d),h=Math.round(c[1]*d),i=!1;z.isW[e]===g||(a.style.width=g+"px",z.isW[e]=g,i=!0),z.isH[e]===h||(a.style.height=h+"px",z.isH[e]=h,i=!0),i&&b.rotate>10&&180!==b.rotate&&(f=(z.isW[e]-z.isH[e])/(270===b.rotate?-2:2)+"px",a.style[b.transform]=b.SetRote.runSL(a,b.transform,"translate("+f+","+f+")"))},x=function(a,c,d,e){if(b.transform){var f=d[1]*e+"px";a.style[c]=b.SetRote.run(a,c,d[0],"translate("+f+","+f+")")}else a.style[c]=d},y=u[0],this.domimg=[u[0],c],this.close_=function(){for(var b=0;c>b;b++)t=y[b],t.src=e,"cssText"in t.style?t.style.cssText="":t.setAttribute("style","");this.dom.style.display="none",a.Effects&&(a.Effects.style.display="none"),this.dom.parentNode.style.width=a.scopeWidth+2+"px"},this.handle=function(b,e,f,h){var i,j,k,l,m,z,A,B,C,D;for(e&&this.open_(h||a,f),i=b.left,j=b.top,k=b.formAllW,l=b.imgUrl,m=b.TF,z=b.styleR,A=b.R,B=b.formAllH,C=b.HTML3D,n="boolean"==typeof l?d:v,o=m?w:d,p="boolean"==typeof A?d:x,"boolean"==typeof i?i=d:(r=i+a.Border,s=j+a.Border,i=function(a){C.setLT(t,r*a+"px",s*a+"px")}),D=0;c>D;D++)t=y[D],q=a.preview[D]/k,i(q),g(u,a.preview,D,[k,B]),n(t,l),o(t,this.WH,q,D),p(t,z,A,q)}}},dom:!1,domWidth:0,domimg:!1,WH:new Array(2),parentNodes:!1,EffTrue:!1,handle:function(a,b,c){b&&this.open_(c)},close_:function(){this.arg.Effects&&(this.arg.Effects.style.display="none"),this.parentNodes&&(this.parentNodes.style.width=this.arg.scopeWidth+2+"px")},open_:function(a){var b=0;this.arg=a,this.EffTrue?(a.Effects.style.display="block",a.Effects.scrollTop=0,a.Effects.style.height=a.scopeHeight+"px",this.parentNodes=a.Effects.parentNode,b=a.Effects.offsetWidth):a.Effects&&(a.Effects.parentNode.removeChild(a.Effects),a.Effects=!1),this.dom?(this.dom.style.display="block",this.dom.parentNode.style.width=a.scopeWidth+this.domWidth+b+10+"px"):a.Effects&&(a.Effects.parentNode.style.width=a.scopeWidth+this.domWidth+b+2+"px")}},Rotate:function(a){var b,c,d;this.transform?("left"===a?this.rotate-=90:this.rotate+=90,this.rotate={"-90":270,0:0,"-270":90,360:0,180:180,90:90,270:270,"-360":0,"-180":180}[this.rotate]||0,b="rotate("+this.rotate+"deg)",c=this._exchange_(),this.setinitial(this.arg,!0),d=c(this.arg.ImgMain,this.arg.ImgDom,b),this.preview.handle({left:this.ImgDomL,top:this.ImgDomT,formAllW:this.formAllW,formAllH:this.formAllH,imgUrl:!1,styleR:this.transform,R:[b,d],HTML3D:this.HTML5})):("left"===a?this.rotate-=1:this.rotate+=1,this.rotate=this.rotate>3?0:this.rotate<0?3:this.rotate,this.ImgRotateFun=1===this.rotate||3===this.rotate?function(a,b){return[b,a]}:function(a,b){return[a,b]},this.arg.ImgMain.style.filter=this.arg.ImgDom.style.filter=b="progid:DXImageTransform.Microsoft.BasicImage(rotation="+this.rotate+")",this._ieexchange_(),this.preview.handle({left:!1,top:!1,formAllW:this.formAllW,formAllH:this.formAllH,imgUrl:!1,styleR:"filter",R:b,HTML3D:this.HTML5}),this.setinitial(this.arg,!0))},pointhandle:function(a,b,c,d,e,f,g){function h(b,c,d,e){if(b+=e,b>c&&e>0)return k.setT(m,c+"px"),a?setTimeout(function(){h(c,j,d,-1)},a):"function"==typeof g&&g(),void 0;if(c>b&&0>e)try{i.arg.scope.removeChild(m)}catch(f){}else k.setT(m,b+"px"),setTimeout(function(){h(b,c,d,e)},d)}var i,j,k,l,m=this.arg.scope.children[0];if("point"===m.className&&this.arg.scope.removeChild(m),-1!==a){switch(m=document.createElement("div"),m.className="point",this.arg.scope.insertBefore(m,this.arg.scope.childNodes[0]),i=this,j=-35,k=this.HTML5,m.style.color=f,m.style.backgroundColor=e,m.innerHTML="<i></i>"+c,l=m.getElementsByTagName("i")[0],d){case 0:l.style.backgroundPosition="-16px 0";break;case 1:l.style.backgroundPosition="0 0";break;case 2:l.style.backgroundPosition="-31px 0"}h(j,0,b,1)}},setinitial:function(a,b){var c,d,e,f,g,h,i=0,j=0,k=!a.traverse,l=this.HTML5;this.BoxW>this.ImgWidth?(this.relatW=this.ImgWidth,a.relat.style.width=this.ImgWidth+"px",g=Math.round(.5*(this.BoxW-this.ImgWidth)),c=(this.relatL=g)+"px",d=-g+"px"):(a.relat.style.width=this.BoxW+"px",this.relatW=this.BoxW,c=d=this.relatL=0,k&&(i=(this.BoxW-this.ImgWidth)/2)),this.BoxH>this.ImgHeight?(this.relatH=this.ImgHeight,a.relat.style.height=this.ImgHeight+"px",h=Math.round(.5*(this.BoxH-this.ImgHeight)),this.relatT=h,e=h+"px",f=-h+"px"):(this.relatH=this.BoxH,a.relat.style.height=this.BoxH+"px",e=f=this.relatT=0,k&&(j=(this.BoxH-this.ImgHeight)/2)),l.setLT(a.relat,c,e),l.setLT(a.black,d,f),this.AmendOffset(),this.MovePhoto(b,i,j,k)},MovePhoto:function(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o=this.arg,p=o.ImgDom,q=o.ImgMain,r=this.HTML5;o.traverse&&this.BoxW<this.ImgWidth?(k=this.ImgWidth-this.BoxW,e=this.BoxW-this.formAllW,f=e&&k/e,l=Math.round(-this.formLeft*f),g=l,i=l-this.formLeft-this.Border):(g=b=o.traverse?0:d?b:this.ImgMainL,i=b-this.formLeft-this.Border),o.traverse&&this.BoxH<this.ImgHeight?(m=this.ImgHeight-this.BoxH,e=this.BoxH-this.formAllH,f=e&&m/e,n=Math.round(-this.formTop*f),h=n,j=n-this.formTop-this.Border):(h=c=o.traverse?0:d?c:this.ImgMainT,j=c-this.formTop-this.Border),this.ImgMainT=h,this.ImgMainL=g,this.ImgDomL=i,this.ImgDomT=j,r.setLT(q,g+"px",h+"px"),r.setLT(p,i+"px",j+"px"),this.preview.handle({left:i,top:j,formAllW:this.formAllW,formAllH:this.formAllH,imgUrl:!1,TF:a,styleR:!1,R:!1,HTML3D:r})},AmendOffset:function(){var a,b,c,d,e,f,g,h=this.HTML5,i=h.getLT(this.formParent);"boolean"==typeof this.formLeft&&(this.formLeft=parseFloat(i[0])),"boolean"==typeof this.formTop&&(this.formTop=parseFloat(i[1])),this.saveL?(this.formLeft=this.saveL-this.relatL,this.formTop=this.saveT-this.relatT):(this.formLeft-=this.relatL,this.formTop-=this.relatT),this.formLeft<0&&(this.formLeft=0,this.saveL=this.relatL),this.formTop<0&&(this.formTop=0,this.saveT=this.relatT),h.setLT(this.formParent,this.formLeft+"px",this.formTop+"px"),a=this.formLeft+this.formAllW,b=this.formTop+this.formAllH,c=!1,d=!1,a>this.relatW&&(e=a-this.relatW,e>this.formLeft?(this.formW=this.formW-(e-this.formLeft),this.formLeft=0,c="0px",this.saveL=this.relatL,this.formAllW=this.formW+this.Mdouble):(this.formLeft-=e,c=this.formLeft+"px",this.saveL=this.formLeft+this.relatL)),b>this.relatH&&(f=b-this.relatH,f>this.formTop?(this.formH=this.formH-(f-this.formTop),this.formTop=0,d="0px",this.saveT=this.relatT,this.formAllH=this.formH+this.Mdouble):(this.formTop=this.formTop-f,d=this.formTop+"px",this.saveT=this.formTop+this.relatT)),c&&d?h.setLT(this.formParent,c,d):c?h.setL(this.formParent,c):d&&h.setT(this.formParent,d),this.arg.proportional[0]&&(g=Math.round(this.formAllW/this.arg.proportional[0]),g>this.formAllH?(this.formAllW=Math.round(this.formAllH*this.arg.proportional[0]),this.formW=this.formAllW-this.Mdouble):(this.formAllH=g,this.formH=g-this.Mdouble)),this.arg.form.style.width=this.formW+"px",this.arg.form.style.height=this.formH+"px",this.ie6(this.formParent,this.formAllW,this.formAllH)},MaxMinLimit:function(a){a.ImgWidth=a.ImgOWidth=this.width,a.ImgHeight=a.ImgOHeight=this.height,"number"==typeof a.arg.Max&&(a.ImgWidth>a.arg.Max&&(a.ImgWidth=a.arg.Max,a.ImgHeight=Math.round(a.ImgWidth/a.ImgScales)),a.ImgHeight>a.arg.Max&&(a.ImgHeight=a.arg.Max,a.ImgWidth=Math.round(a.ImgHeight*a.ImgScales)));var b,c;a.arg.proportional[0]?(b=a.Min,c=Math.round(b*a.arg.proportional[0]),c<a.Min&&(c=a.Min,b=Math.round(c/a.arg.proportional[0]))):c=b=a.Min,a.ImgWidth<c&&(a.ImgWidth=c,a.ImgHeight=Math.round(a.ImgWidth/a.ImgScales)),a.ImgHeight<b&&(a.ImgHeight=b,a.ImgWidth=Math.round(a.ImgHeight*a.ImgScales)),a.artworkW=a.ImgWidth,a.artworkH=a.ImgHeight},run:function(a,b){this.HTML5.HTML5PHP=b;var c=this,d=this.arg,e=this.HTML5.canvas&&b?a:d.relativeUrl+a,f=this.HTML5.Images=new Image;this.defaultShear(),this.arg=d,this.HTML5.canvas&&b||(this.ImgUrl=a),f.onload=function(){var b,f,g;return!(this.width=Math.round(this.width))>0||!(this.height=Math.round(this.height))>0?(c.pointhandle(3e3,10,"请选择正确图片",0,"#f82373","#fff"),void 0):(d.ImgMain.src=d.ImgDom.src=e,d.black.style.zIndex=99,c.ImgScales=this.width/this.height,c.Min=d.Min,c.MaxMinLimit.call(this,c),d.ImgMain.style.width=d.ImgDom.style.width=c.artworkW+"px",d.ImgMain.style.height=d.ImgDom.style.height=c.artworkH+"px",c.BoxW=d.scope.offsetWidth-2,c.BoxH=d.scope.offsetHeight-2,c.Border=d.Border,c.Mdouble=2*d.Border,d.proportional[0]?(b=d.proportional[1]-c.Mdouble,f=d.proportional[1]/d.proportional[0]-c.Mdouble):(b=d.proportional[1]-c.Mdouble,f=d.proportional[2]-c.Mdouble),c.formW=b=Math.round(b),c.formH=f=Math.round(f),c.formAllW=b+c.Mdouble,c.formAllH=f+c.Mdouble,c.preview.WH=[c.artworkW,c.artworkH],c.formParent=d.form.offsetParent,c.et(),c.setinitial(d),c.preview.handle({left:!1,top:!1,formAllW:c.formAllW,formAllH:c.formAllH,TF:!0,imgUrl:e,styleR:!1,R:!1,HTML3D:c.HTML5},!0,d),g=c.MoveDiv=new window.ShearPhoto.MoveDiv,g.reckon(d.relat,!1),g.selectionempty=c.selectionempty,g.addevent=c.addevent,g.HTML5=c.HTML5,g.run({to:new Array(d.form),form:c.formParent,MoveWidth:c.relatW,MoveHeight:c.relatH,shifting:new Array,center:1,centerFront:function(){return[c.relatW,c.relatH]},DivDownFun:function(a){a.arg.MoveWidth=c.relatW,a.arg.MoveHeight=c.relatH,a.DivW=c.formW+c.Mdouble,a.DivH=c.formH+c.Mdouble},centerfun:function(a,b,d){c.formLeft=a,c.formTop=b,c.MovePhoto(!1,0,0),d.arg.MoveWidth=c.relatW,d.arg.MoveHeight=c.relatH,d.DivW=c.formW+c.Mdouble,d.DivH=c.formH+c.Mdouble},zIndex:100,MoveFun:function(a,b){c.formLeft=a,c.formTop=b,c.MovePhoto(!0,0,0)}}),c.MoveDivEve=function(){g.delDownEve()},d.Shearbar.style.display="block",d.SelectBox.style.visibility="hidden",c.zoom(),c.pointhandle(2e3,10,"可以拖动或拉伸蓝边框进行截图",1,"#fbeb61","#3a414c"),delete e,delete a,void 0)},f.onerror=function(){c.pointhandle(0,10,"无法读取图片。图片类型或路径不正确 或 relativeUrl参数是否存在问题",0,"#f82373","#fff")},this.pointhandle(0,1,"图片已加载，正在创建截图环境，请稍等........",2,"#fbeb61","#3a414c",function(){f.src=e})},config:function(a){var b,c,d,e,f,g,h;if(this.arg=a,a.Shearbar.style.display="none",a.scope.style.width=a.black.style.width=a.SelectBox.style.width=a.scopeWidth+"px",a.scope.style.height=a.black.style.height=a.SelectBox.style.height=a.scopeHeight+"px",b=a.scope.parentNode,b.style.width=b.parentNode.style.width=a.scopeWidth+2+"px",this.HTML5.IfHTML5(this.transform,a.HTML5,a.HTML5MAX),this.HTML5.HTML5LT(a.translate3d&&this.transform),c=this.transform?function(a,b){a.style.opacity=b}:function(a,b){a.style.filter="alpha(opacity="+100*b+")"},a.Border>0){a.DynamicBorder[0].style.display=a.DynamicBorder[1].style.display=a.DynamicBorder[2].style.display=a.DynamicBorder[3].style.display="none",a.DynamicBorder[0].style.background=a.DynamicBorder[1].style.background=a.DynamicBorder[2].style.background=a.DynamicBorder[3].style.background="#FFF";for(d in a.to)a.to[d].style.border="1px solid "+a.BorderColor,a.to[d].style.background=a.BorderColor,c(a.to[d],1);a.form.style.border=a.Border+"px"+"  "+a.BorderStyle+"  "+a.BorderColor}if(a.black.style.background=a.backgroundColor,c(a.black,a.backgroundOpacity),this.preview.run(a,this),a.scope.ondragstart=function(){return!1},this.ie6=navigator.userAgent.indexOf("MSIE 6.0")>0&&0===a.Border?function(b,c,d){b.style.height=a.DynamicBorder[1].style.height=a.DynamicBorder[2].style.height=d+"px",b.style.width=c+"px"}:function(){},this.preview.EffTrue=a.HTML5Effects&&this.HTML5.canvas&&a.Effects)for(f=a.Effects.getElementsByTagName("a"),g=this.HTML5.Effects,this.HTML5.artwork=this.HTML5.Aclick=f[0],h=0;h<f.length;h++)e=f[h],e.onclick=g.call(this,e.getAttribute("StrEvent"),this.HTML5);this.pointhandle(3e3,10,"请选择本地照片、相册、拍照，进行截取头像",2,"#307ff6","#fff")},zoom:function(){var a,b,c,d,e,f,g,h=this,i=new window.ShearPhoto.MoveDiv;i.reckon(h.arg.ZoomDist,!1),i.selectionempty=h.selectionempty,i.addevent=h.addevent,i.HTML5=this.HTML5,c=h.arg.ZoomBar,h.arg.proportional[0]?(a=h.Min,b=Math.round(a*h.arg.proportional[0]),b<h.Min&&(b=h.Min,a=Math.round(b/h.arg.proportional[0]))):b=a=h.Min,i.run({to:[c],form:c,MoveWidth:i.ReckonWH.W,MoveHeight:i.ReckonWH.H,shifting:new Array,center:1,zIndex:100,DivDownFun:function(){h.saveL=h.formLeft+h.relatL,h.saveT=h.formTop+h.relatT},cursor:"pointer",MoveFun:function(c){var d,i,j,k;d=e>c?Math.round(g*c+10)/100:Math.round(c*f-100)/100,i=Math.round(h.artworkW*d),j=Math.round(h.artworkH*d),b>i&&(i=b,j=Math.round(i/h.ImgScales)),a>j&&(j=a,i=Math.round(j*h.ImgScales)),k=h.ImgRotateFun(i,j),h.ImgWidth=k[0],h.ImgHeight=k[1],h.arg.ImgMain.style.width=h.arg.ImgDom.style.width=i+"px",h.arg.ImgMain.style.height=h.arg.ImgDom.style.height=j+"px",h.preview.WH=[i,j],h.setinitial(h.arg,!0)}}),h.zoomEve=function(){i.delDownEve()},d=i.ReckonWH.W-i.DivW,e=.5*d,f=200/e,g=90/e},PointerShape:function(a){this.arg.scope.style.cursor=this.arg.form.style.cursor=a},DelPointerShape:function(){this.arg.scope.style.cursor="",this.arg.form.style.cursor="move"},ShearPhotoDown:function(a,b){this.addEvent(a,"mousedown",b),this.addEvent(a,"touchstart",b)},delShearPhotoDown:function(a,b){this.delEvent(a,"mousedown",b),this.delEvent(a,"touchstart",b)},et:function(){for(var a in this.arg.to)"add"===this.addevent?("function"!=typeof this.DivDownEVe[a]?this.DivDownEVe[a]=this.DivDown(a):this.delShearPhotoDown(this.arg.to[a],this.DivDownEVe[a]),this.ShearPhotoDown(this.arg.to[a],this.DivDownEVe[a])):this.arg.to[a].onmousedown=this.DivDown(a)},addEvent:function(a,b,c){var d={add:function(){a.addEventListener(b,c,!1)},att:function(){a.attachEvent("on"+b,c)}};d[this.addevent]&&d[this.addevent]()},delEvent:function(a,b,c){var d={add:function(){a.removeEventListener(b,c,!1)},att:function(){a.detachEvent("on"+b,c)}};d[this.addevent]&&d[this.addevent]()},DomUp:function(a){var b=this;return function(){return"function"==typeof b.arg.UpFun&&b.arg.UpFun(),a.releaseCapture&&a.releaseCapture(),b.DelPointerShape(),"function"==typeof b.DomMoveEve&&b.delEvent(document,b.eveMold[1],b.DomMoveEve),"function"==typeof b.DomUpEve&&(b.delEvent(document,b.eveMold[2],b.DomUpEve),b.delEvent(window,b.eveMold[2],b.DomUpEve),b.delEvent(window,"blur",b.DomUpEve),b.delEvent(a,"losecapture",b.DomUpEve)),!1}},setWHfalse:function(a,b,c,d,e,f){return b>e&&(b=e),c>f&&(c=f),b<this.Min&&(b=this.Min),c<this.Min&&(c=this.Min),[b,c]},setWfalse:function(a,b,c,d,e){return b>e&&(b=e),b<this.Min&&(b=this.Min),[b,this.formAllH]},setHfalse:function(a,b,c,d,e,f){return c>f&&(c=f),c<this.Min&&(c=this.Min),[this.formAllW,c]},CycleCalculation:function(a,b,c,d,e){return b>e?(b=e,a=Math.round(b*c),this.CycleCalculation.apply(this,arguments)):a>d?(a=d,b=Math.round(a/c),this.CycleCalculation.apply(this,arguments)):b<this.Min?(b=this.Min,a=Math.round(b*c),this.CycleCalculation.apply(this,arguments)):a<this.Min?(a=this.Min,b=Math.round(a/c),this.CycleCalculation.apply(this,arguments)):[a,b]},setHtrue:function(a,b,c,d,e,f){return b=Math.round(c*d),this.CycleCalculation(b,c,d,e,f)},setWtrue:function(a,b,c,d,e,f){return c=Math.round(b/d),this.CycleCalculation(b,c,d,e,f)},amend:function(a,b,c,d,e){var f,g,h=a-this.formAllW,i=b-this.formAllH,j=this,k=this.HTML5,l={LL:function(){f=Math.round(j.formLeft-h),j.formLeft=f,k.setL(c,f+"px")},TT:function(){g=Math.round(j.formTop-i),j.formTop=g,k.setT(c,g+"px")},ML:function(){h*=.5,f=j.formLeft-h,j.formLeft=f,k.setL(c,f+"px")},MT:function(){i*=.5,g=j.formTop-i,j.formTop=g,k.setT(c,g+"px")},NO:function(){}};l[d](),l[e]()},DomMove:function(a,b,c,d,e,f,g,h,i,j,k){var l,m,n,o,p,q;return a.arg.ImgMain,a.arg.ImgDom,"function"==typeof a.DomUpEve&&(a.delEvent(document,a.eveMold[2],a.DomUpEve),a.delEvent(window,a.eveMold[2],a.DomUpEve),a.delEvent(window,"blur",a.DomUpEve),a.delEvent(b,"losecapture",a.DomUpEve)),a.DomUpEve=a.DomUp(b),a.addEvent(document,a.eveMold[2],a.DomUpEve),a.addEvent(window,a.eveMold[2],a.DomUpEve),a.addEvent(window,"blur",a.DomUpEve),a.addEvent(b,"losecapture",a.DomUpEve),function(b){return b=b||window.event,b.button>1?(a.DomUp(this)(),!1):(l=a.eveMold[3](b,"clientX"),m=a.eveMold[3](b,"clientY"),q=a.arg.form,setTimeout(function(){o=e*(l-c),p=f*(m-d),a.selectionempty(),n=a.drawfun(q,o,p,a.arg.proportional[0],h,i),o=n[0],p=n[1],a.amend(o,p,g,j,k),a.formAllW=o,a.formAllH=p,o=a.formW=o-a.Mdouble,p=a.formH=p-a.Mdouble,q.style.width=o+"px",q.style.height=p+"px",a.ie6(g,o,p),a.MovePhoto(!0,0,0)},1),!1)}},defaultShear:function(){this.arg.Shearbar.style.display="none","function"==typeof this.MoveDivEve&&this.MoveDivEve(),"function"==typeof this.zoomEve&&this.zoomEve(),"cssText"in this.arg.ImgMain.style?this.arg.ImgMain.style.cssText=this.arg.ImgDom.style.cssText="":(this.arg.ImgMain.setAttribute("style",""),this.arg.ImgDom.setAttribute("style","")),this.arg=this.ImgUrl=this.formW=this.formH=this.formAllW=this.formAllH=this.drawfun=this.formParent=this.ImgWidth=this.ImgHeight=this.artworkW=this.artworkH=this.BoxW=this.BoxH=this.Border=this.Mdouble=this.ImgScales=this.Min=this.formLeft=this.formTop=this.relatL=this.relatT=this.relatW=this.relatH=this.saveL=this.ImgOWidth=this.ImgOHeight=this.saveT=this.HTML5.lock=this.HTML5.PhotoHTML5True=!1,this.rotate=this.ImgMainT=this.ImgDomT=this.ImgMainL=this.ImgDomL=0,this.preview.isW=[],this.preview.isH=[],this.ImgRotateFun=function(a,b){return[a,b]}},SendUserMsg:function(a,b,c,d,e,f,g,h){this.arg.black.style.zIndex=f?199:99,this.pointhandle(b,5,a,c,d,e,h),this.arg.Shearbar.style.display=g?"none":"block"},again:function(){this.arg.SelectBox.style.visibility="visible",this.arg.Shearbar.style.display="none",this.arg.ImgDom.src=this.arg.ImgMain.src=this.arg.relativeUrl+"images/default.gif"},CoordinateData:function(a){var b,c,d,e,f,g,h,i=function(a,b,c){return 1>a&&(a=1,b=Math.round(1/c)),1>b&&(b=1,a=Math.round(c)),[a,b]},j={};return a||(j.url="../"+this.ImgUrl),b={1:270,2:180,3:90,90:270,180:180,270:90}[this.rotate]||(b=this.rotate),c=this.ImgWidth,d=this.ImgHeight,e={0:c,90:d,180:c,270:d},f=this.ImgOWidth/e[b],j.R=b,j.X=Math.round((Math.abs(this.ImgDomL)-this.Border)*f),j.Y=Math.round((Math.abs(this.ImgDomT)-this.Border)*f),j.P=this.arg.proportional[0],g=this.formAllW/this.formAllH,h=i(Math.round(this.formAllW*f),Math.round(this.formAllH*f),g),j.IW=h[0],j.IH=h[1],h=i(this.formAllW,this.formAllH,g),j.FW=h[0],j.FH=h[1],j},SendPHP:function(a){var b,c,d=this,e=this.HTML5;this.SendUserMsg("正在为你处理截图，稍等...",0,2,"#fbeb61","#3a414c",!0,!0,function(){var f,g;if((e.HTML5PHP||e.PhotoHTML5True)&&e.canvas)try{e.BOLBID&&e.URL.revokeObjectURL(e.BOLBID),b=d.CoordinateData(!0),c=e.CanvasImg(b,a,d)}catch(h){return d.SendUserMsg("错误：切割图片时严重报错,请更换浏览器试试，或者换张图片",5e3,0,"#f4102b","#fff",!1),void 0}else{if(f="","[object Object]"===Object.prototype.toString.call(a))for(g in a)f+="&"+g+"="+a[g];b=d.CoordinateData(),c="JSdate="+window.ShearPhoto.JsonString.JsonToString(b)+f}d.MyAjax.carry({url:d.arg.url,data:c,type:"POST",timeout:9e4,async:!0,lock:!0,complete:!1,success:function(a){return a=window.ShearPhoto.JsonString.StringToJson(a),a===!1?(d.SendUserMsg("错误：请保证后端环境运行正常",5e3,0,"#f4102b","#fff",!1),void 0):a["erro"]?(d.SendUserMsg("错误："+a["erro"],5e3,0,"#f4102b","#fff",!1),void 0):("function"==typeof d.complete&&d.complete(a),delete d.HTML5.Images,void 0)},error:function(){d.SendUserMsg("错误：连接后端失败，可能原因，超时！或者后端环境无法运行",5e3,0,"#f4102b","#fff",!1)},cache:!1})})},DivDown:function(a){var b,c,d,e,f,g,h,i=this,j=1,k=1,l="NO",m="NO";return function(n){var o,p,q,r,s,t,u,v,w,x;if(n=n||window.event,q=n.button,r=typeof q,n.preventDefault&&n.preventDefault(),"number"!==r?(i.eveMold=["touchstart","touchmove","touchend",function(a,b){return a.touches[0][b]}],o=n.touches[0].clientX,p=n.touches[0].clientY):(i.eveMold=["mousedown","mousemove","mouseup",function(a,b){return a[b]}],o=n.clientX,p=n.clientY),2>q||"number"!==r){switch(d=i.formAllW,e=i.formAllH,g=i.formParent,f=i.formLeft,h=i.formTop,a){case"BottomRight":b=i.relatW-f,c=i.relatH-h,i.drawfun=i.arg.proportional[0]?i.setHtrue:i.setWHfalse,i.PointerShape("nw-resize");break;case"TopRight":k=-1,m="TT",b=i.relatW-f,c=h+i.formAllH,i.drawfun=i.arg.proportional[0]?i.setHtrue:i.setWHfalse,i.PointerShape("ne-resize");break;case"Bottomleft":j=-1,l="LL",b=f+i.formAllW,c=i.relatH-h,i.drawfun=i.arg.proportional[0]?i.setHtrue:i.setWHfalse,i.PointerShape("ne-resize");break;case"Topleft":k=j=-1,l="LL",m="TT",b=f+i.formAllW,c=h+i.formAllH,i.drawfun=i.arg.proportional[0]?i.setHtrue:i.setWHfalse,i.PointerShape("nw-resize");break;case"Topmiddle":l="ML",s=f,t=i.relatW-s-i.formAllW,b=2*Math.min(s,t)+i.formAllW,m="TT",c=h+i.formAllH,k=-1,i.drawfun=i.arg.proportional[0]?i.setHtrue:i.setHfalse,i.PointerShape("n-resize");break;case"leftmiddle":k=j=-1,b=f+i.formAllW,u=h,v=i.relatH-u-i.formAllH,c=2*Math.min(u,v)+i.formAllH,m="MT",l="LL",i.drawfun=i.arg.proportional[0]?i.setWtrue:i.setWfalse,i.PointerShape("e-resize");break;case"Rightmiddle":b=i.relatW-f,u=h,v=i.relatH-u-i.formAllH,c=2*Math.min(u,v)+i.formAllH,m="MT",i.drawfun=i.arg.proportional[0]?i.setWtrue:i.setWfalse,i.PointerShape("e-resize");break;case"Bottommiddle":s=f,t=i.relatW-s-i.formAllW,b=2*Math.min(s,t)+i.formAllW,c=i.relatH-h,i.drawfun=i.arg.proportional[0]?i.setHtrue:i.setHfalse,l="ML",i.PointerShape("n-resize")}w=o-j*d,x=p-k*e,this.setCapture&&this.setCapture(),"function"==typeof i.DomMoveEve&&i.delEvent(document,i.eveMold[1],i.DomMoveEve),i.DomMoveEve=i.DomMove(i,this,w,x,j,k,g,b,c,l,m),i.addEvent(document,i.eveMold[1],i.DomMoveEve)}else i.DomUp(this)();return!1}}},window.ShearPhoto.MINGGE=function(a){function b(){try{var c=function(){"complete"===document.readyState&&(document.detachEvent("onreadystatechange",c),a())},d=window.frameElement}catch(e){return document.attachEvent("onreadystatechange",c),void 0}if(null!=d)return document.attachEvent("onreadystatechange",c),void 0;try{document.documentElement.doScroll("left")}catch(c){return setTimeout(b,13),void 0}a()}var c;"function"==typeof a&&(document.addEventListener?(c=function(){document.removeEventListener("DOMContentLoaded",c,!1),a()},document.addEventListener("DOMContentLoaded",c,!1)):b())},window.ShearPhoto.MoveDiv=function(){this.arg=new Array,this.ReckonWH=this.DivW=this.DivH=this.selectionempty=this.addevent=this.DivDownEVe=this.DomMoveEve=this.DomUpEve=this.eveMold=!1},window.ShearPhoto.MoveDiv.prototype={ZeroSetting:function(){var a,b=this.HTML5.getLT(this.arg.form),c=parseFloat(b[0]),d=parseFloat(b[1]),e=this._size_(window,!0),f=function(){},g=function(){},h=!1;isNaN(c)||(h=!0,this.HTML5.setL(this.arg.form,0),f=function(a,b){0>a&&(a=0),this_.HTML5.setL(b,c-a+"px")}),isNaN(d)||(h=!0,this.HTML5.setT(this.arg.form,0),g=function(a,b){0>a&&(a=0),this_.HTML5.setT(b,d-a+"px")}),h===!0&&(a=this._size_(window,!0),f(e.W-a.W,this.arg.form),g(e.H-a.H,this.arg.form))},reckon:function(a,b){var c,d;this._size_(a),c=this,b===!0&&(d=function(){c.ZeroSetting(),c._size_(a),c.arg.MoveWidth=c.ReckonWH.W,c.arg.MoveHeight=c.ReckonWH.H,c.SetCenter(c.arg)},this.addEvent(window,"resize",d))},_size_:function(a,b){var c,d,e,f;return a===window?(f={add:document.documentElement,att:document.body}[this.addevent],c=f.clientWidth,d=f.clientHeight,e={W:Math.max(f.scrollWidth,c),H:Math.max(f.scrollHeight,d),CW:c,CH:d}):(c=a.offsetWidth,d=a.offsetHeight,e={W:c,H:d,CW:c,CH:d}),b===!0?e:(this.ReckonWH=e,void 0)},DomUp:function(a){var b=this;return function(){return a.releaseCapture&&a.releaseCapture(),"function"==typeof b.DomMoveEve&&b.delEvent(document,b.eveMold[1],b.DomMoveEve),"function"==typeof b.DomUpEve&&(b.delEvent(document,b.eveMold[2],b.DomUpEve),b.delEvent(window,b.eveMold[2],b.DomUpEve),b.delEvent(window,"blur",b.DomUpEve),b.delEvent(a,"losecapture",b.DomUpEve)),!1}},DivWHFun:function(){this.DivW=this.arg.form.offsetWidth,this.DivH=this.arg.form.offsetHeight},DomMove:function(a,b,c,d){var e,f,g,h,i,j,k,l=a.arg.form,m=a.DivW,n=a.DivH,o=function(){},p=a.arg.shifting="[object Array]"===Object.prototype.toString.call(a.arg.shifting)&&a.arg.shifting.length>1?a.arg.shifting:new Array(0,0),q=a.arg.MoveWidth-p[0],r=a.arg.MoveHeight-p[1];return"function"==typeof a.DomUpEve&&(a.delEvent(document,a.eveMold[2],a.DomUpEve),a.delEvent(window,a.eveMold[2],a.DomUpEve),a.delEvent(window,"blur",a.DomUpEve),a.delEvent(b,"losecapture",a.DomUpEve)),a.DomUpEve=a.DomUp(b),a.addEvent(document,a.eveMold[2],a.DomUpEve),a.addEvent(window,a.eveMold[2],a.DomUpEve),a.addEvent(window,"blur",a.DomUpEve),a.addEvent(b,"losecapture",a.DomUpEve),j=q-m,k=r-n,"function"==typeof a.arg.MoveFun&&(o=a.arg.MoveFun),e=[j,k],function(b){return b=b||window.event,b.button>1?(a.DomUp(this)(),!1):(h=a.eveMold[3](b,"clientX"),i=a.eveMold[3](b,"clientY"),setTimeout(function(){f=h-c,g=i-d,a.selectionempty(),f=f<-p[0]?-p[0]:f,f=f>j?j:f,g=g<-p[1]?-p[1]:g,g=g>k?k:g,a.HTML5.setLT(l,f+"px",g+"px"),o(f,g,e)
},1),!1)}},DivDown:function(){var a=this;return function(b){var c,d,e,f,g,h,i,j,k;return b=b||window.event,e=b.button,f=typeof e,b.preventDefault&&b.preventDefault(),"number"!==f?(a.eveMold=["touchstart","touchmove","touchend",function(a,b){return a.touches[0][b]}],c=b.touches[0].clientX,d=b.touches[0].clientY):(a.eveMold=["mousedown","mousemove","mouseup",function(a,b){return a[b]}],c=b.clientX,d=b.clientY),2>e||"number"!==f?(g=a.HTML5.getLT(a.arg.form),h=parseFloat(g[0]),i=parseFloat(g[1]),j=c-h,k=d-i,this.setCapture&&this.setCapture(),"function"==typeof a.arg.DivDownFun&&a.arg.DivDownFun(a),"function"==typeof a.DomMoveEve&&a.delEvent(document,a.eveMold[1],a.DomMoveEve),a.DomMoveEve=a.DomMove(a,this,j,k,h,i),a.addEvent(document,a.eveMold[1],a.DomMoveEve)):a.DomUp(this)(),!1}},ShearPhotoDown:function(a,b){this.addEvent(a,"mousedown",b),this.addEvent(a,"touchstart",b)},delShearPhotoDown:function(a,b){this.delEvent(a,"mousedown",b),this.delEvent(a,"touchstart",b)},et:function(){var a,b=this,c=this.arg.cursor||"move";for(b=this,a=0;a<this.arg.to.length;a++)"add"===this.addevent?("function"!=typeof this.DivDownEVe?this.DivDownEVe=this.DivDown():this.delShearPhotoDown(this.arg.to[a],this.DivDownEVe),this.ShearPhotoDown(this.arg.to[a],this.DivDownEVe)):this.arg.to[a].onmousedown=this.DivDown(),this.arg.to[a].style["cursor"]=c},delDownEve:function(){for(var a=0;a<this.arg.to.length;a++)"add"===this.addevent&&"function"==typeof this.DivDownEVe&&this.delShearPhotoDown(this.arg.to[a],this.DivDownEVe)},setdiv:function(a,b,c,d){var e,f,g;"function"==typeof d.centerFront&&(e=d.centerFront(),b=e[0],c=e[1]),f=Math.round((c-this.DivH)/2),f=0>f?0:f,g=Math.round((b-this.DivW)/2),g=0>g?0:g,this.HTML5.setLT(a,g+"px",f+"px"),"function"==typeof d.centerfun&&d.centerfun(g,f,this)},addEvent:function(a,b,c){var d={add:function(){a.addEventListener(b,c,!1)},att:function(){a.attachEvent("on"+b,c)}};d[this.addevent]&&d[this.addevent]()},delEvent:function(a,b,c){var d={add:function(){a.removeEventListener(b,c,!1)},att:function(){a.detachEvent("on"+b,c)}};d[this.addevent]&&d[this.addevent]()},SetCenter:function(a){var b,c,d;a.center&&(1===a.center?(b=this.ReckonWH.CW,c=this.ReckonWH.CH):(d=this._size_(a.center,!0),b=d.CW,c=d.CH),this.setdiv(a.form,b,c,a))},run:function(a){this.arg=a,this.DivW=a.form.offsetWidth,this.DivH=a.form.offsetHeight,this.SetCenter(a),"number"==typeof a.zIndex&&(a.form.style.zIndex=a.zIndex),this.et()}},window.ShearPhoto.JsonString={_json_:null,JsonToString:function(a){try{this._json_=new Array,this._read_(a,!0);var b=this._json_.join("");return b=b.replace(/,([\}\]])/g,function(a,b){return b}),this._json_=null,b}catch(c){return alert("发生错误，错误代码--"+c),""}},StringToJson:function(a){var b,c;if("string"!=typeof a)return alert("请传入JSON字串符,看清楚demo.html是怎么操作的"),void 0;try{return b=new Function("return ("+a+")")(),c=this._type_(b),"[object Object]"!==c&&"[object Array]"!==c?(alert("严重报错：后端没返回到JSON，而是一串无效字符串。\n\n你是在调试吗？\n\n那么按确定，查看那串无效字符串吧"),alert(a),!1):b}catch(d){return alert("严重报错：后端没返回到JSON，而是一串无效字符串。\n\n你是在调试吗？\n\n那么按确定，查看那串无效字符串吧"),alert(a),!1}},_type_:function(a){if("number"==typeof a.nodeType)return"[object document]";var b=Object.prototype.toString.call(a);return b},_addjson_:function(a,b,c){var d={"[object Object]":b,"[object Array]":c};this._json_.push(d[a])},_addstring_:function(a){var b,c=typeof a;return"string"===c?'"'+a+'"':"number"===c?a:(b=this._type_(a),"[object Object]"===b||"[object Array]"===b?!1:'""')},_read_:function(a,b){var c,d,e=this._type_(a);if(b&&"[object Object]"!==e&&"[object Array]"!==e)return alert("你传入不是数组或JSON,看清楚demo.html是怎么操作的"),this._json_=null,!1;this._addjson_(e,"{","[",b);for(c in a)"undefined"==typeof a.constructor.prototype[c]&&(d=this._addstring_(a[c]),"boolean"!=typeof d?this._addjson_(e,'"'+c+'":'+d+",",d+","):(this._addjson_(e,'"'+c+'":',""),this._read_(a[c],!1)));b=b?"":",",this._addjson_(e,"}"+b,"]"+b)}},window.ShearPhoto.MyAjax=function(){this.serverdata=this.erromsg=this.timeout=this.stop=this.xmlhttp=!1,this.transit=!0},window.ShearPhoto.MyAjax.prototype.handle=function(a,b){if(4==a.readyState){if(this.stop===!0)return;if(this.transit=!0,b.timeout&&b.async&&(clearTimeout(this.timeout),this.timeout=!1),200==a.status){var c=this.serverdata=a.responseText.replace(/(^\s*)|(\s*$)/g,"");"function"==typeof b.success&&b.success(c)}else this.erromsg=a.status,"function"==typeof b.error&&b.error(a.status)}else if(0==a.readyState){if(this.stop===!0)return;b.timeout&&b.async&&(clearTimeout(this.timeout),this.timeout=!1),this.erromsg=a.readyState,this.transit=!0,"function"==typeof b.error&&b.error(a.readyState)}},window.ShearPhoto.MyAjax.prototype.out=function(a){this.transit=!0,this.erromsg=504,this.stop=!0,"function"==typeof a.error&&a.error(504)},window.ShearPhoto.MyAjax.prototype.carry=function(a){var b,c,d,e;if(a.lock&&!this.transit)return!1;this.transit=!1,this.stop=this.erromsg=!1,b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),a.type=a.type.toUpperCase(),c=function(){},"string"==typeof a.data?(a.data=a.data.replace(/(^\s*)|(\s*$)/g,""),c=function(){b.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}):"[object FormData]"!==Object.prototype.toString.call(a.data)?(a.data="",c=function(){b.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}):("function"==typeof a.progress&&b.upload.addEventListener("progress",a.progress,!1),a.type="POST"),d=""==a.data?[null,""]:[a.data,"?"+a.data],e=this,"function"==typeof a.complete&&a.complete(),a.timeout&&a.async&&(this.timeout=setTimeout(function(){e.out(a)},a.timeout)),a.async===!0&&(b.onreadystatechange=function(){e.handle(b,a)});try{switch(a.type){case"POST":b.open("POST",a.url,a.async),c();break;default:b.open("GET",a.url+d[1],a.async),a.cache===!0||b.setRequestHeader("If-Modified-Since","0")}}catch(f){return this.erromsg=505,a.timeout&&a.async&&(clearTimeout(this.timeout),this.timeout=!1),this.transit=!0,"function"==typeof a.error&&a.error(505),void 0}b.send(d[0]),a.async===!1&&e.handle(b,a)},window.ShearPhoto.frameUpImg=function(a){this.BodyDom=document.body,this.FORM=a.FORM,this.upfile=this.FORM.UpFile,this.config=a,this.upfileclick=!1,"function"!=typeof a.erro&&(a.erro=function(){}),this.FORM.action=a["url"];var b=this;this.parentNodes=this.upfile.parentNode,window.attachEvent&&(this.parentNodes.onmousemove=function(){var a=window.event.offsetX+5;0>a&&(a=0),a>224&&(a=224),b.upfile.style.width=a+"px"})},window.ShearPhoto.frameUpImg.prototype={createframe:function(){this.BodyDom.insertAdjacentHTML("afterBegin",'<iframe name="POSTiframe"   class="displayNone"  ></iframe>'),this.iframe=document.getElementsByName("POSTiframe")[0],this.createEve(this.iframe,window.frames["POSTiframe"])},createEve:function(a,b){var c=this;this.upfile.files?a.onload=function(){var d,e;a.onload=null,d=b.document.getElementsByTagName("BODY")[0],e=d.innerHTML,c.Evebubbling(e)}:a.onreadystatechange=function(){var d,e;"complete"===a.readyState&&(a.onreadystatechange=null,d=b.document.getElementsByTagName("BODY")[0],e=d.innerHTML,c.Evebubbling(e))}},delframe:function(){this.BodyDom.removeChild(this.iframe),this.DelCreateUpfile()},Evebubbling:function(a){""!=a&&(this.upfile.onclick=this.upfileclick,"function"==typeof this.fun&&this.fun(a),this.delframe())},inArray:function(a,b){if(b.indexOf)return b.indexOf(a);for(var c=0,d=b.length;d>c;c++)if(b[c]===a)return c;return-1},DelCreateUpfile:function(){var a,b=this.upfile.onchange;this.upfile.onchange=this.upfile.onclick=null,this.parentNodes.removeChild(this.upfile),a=document.createElement("input"),a.setAttribute("type","file"),a.setAttribute("name","UpFile"),this.parentNodes.appendChild(a),this.upfile=a,this.upfile.onchange=b,this.upfile.onclick=this.upfileclick},Upsubmit:function(a){var b,c,d,e;try{if(b=a.value.split("."),b="[object Array]"===Object.prototype.toString.call(b)?b[b.length-1]:"",-1==this.inArray(b.toLowerCase(),this.config.UpType))return this.DelCreateUpfile(),this.config.erro("请选择正确图片类型"),void 0;if(d=a.files){if(d=d[0],d.type&&(c="image/gif"===d.type?"image/jpeg":d.type,this.config.HTML5.ImagesType=c),d.size<=0)return this.DelCreateUpfile(),this.config.erro("错误：不能选择空字节文件"),void 0;if(this.config.HTML5.canvas){if(d.size>1048576*this.config.HTML5FilesSize)return this.DelCreateUpfile(),this.config.erro("错误：HTML5上传不能大于"+this.config.HTML5FilesSize+"M"),void 0}else if(d.size>1048576*this.config.FilesSize)return this.DelCreateUpfile(),this.config.erro("错误：文件不能大于"+this.config.FilesSize+"M"),void 0}e=this,"function"==typeof this.config.preced&&this.config.preced(function(){if(e.config.HTML5.canvas){var a=new FileReader;return a.onload=function(){e.DelCreateUpfile(),e.config.HTML5.zipImg(this.result,e.config.HTML5ZIP,c,function(b){"function"==typeof e.fun&&e.fun({success:b},!0),delete a})},a.readAsDataURL(d),void 0}e.createframe(),e.FORM.submit()})}catch(f){return this.DelCreateUpfile(),this.config.erro("你选择了非图片类型，或 图片路径有误"),void 0}},run:function(a){var b=this;this.fun=a,this.upfile.onclick=this.upfileclick=function(){"function"==typeof b.config.fileClick&&b.config.fileClick()},this.upfile.onchange=function(){return""==this.value?!1:(this.onclick=function(){return!1},b.Upsubmit(this),void 0)}}};